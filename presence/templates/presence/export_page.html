{% extends 'presence/base.html' %}

{% load static %}

{% block title %}Exports - {{ block.super }}{% endblock %}

{% block css %}
    {{ block.super }}
    <link rel="stylesheet" href="{% static 'presence/mobile/export_page.css' %}">
{% endblock %}

{% block content %}
<div class="export-container">
    <!-- En-t√™te principal -->
    <div class="export-header">
        <h1>üìä <span class="desktop-only">Centre d'Export</span><span class="mobile-only">Exports</span></h1>
        <p class="desktop-only">G√©n√©rez et t√©l√©chargez vos rapports personnalis√©s au format Excel</p>
        <p class="mobile-only">T√©l√©chargez vos rapports Excel</p>
    </div>

    <!-- Section statistiques -->
    <div class="stats-section">
        <div class="stats-grid">
            <div class="stat-item">
                <span class="stat-number">{{ total_licencies|default:"0" }}</span>
                <div class="stat-label">Licenci√©s</div>
            </div>
            <div class="stat-item">
                <span class="stat-number">{{ total_sessions|default:"0" }}</span>
                <div class="stat-label">Sessions</div>
            </div>
            <div class="stat-item">
                <span class="stat-number">{{ total_users|default:"0" }}</span>
                <div class="stat-label">Sensei</div>
            </div>
            <div class="stat-item">
                <span class="stat-number">{{ total_etablissements|default:"0" }}</span>
                <div class="stat-label">Dojo</div>
            </div>
        </div>
    </div>

    <!-- Grille des exports -->
    <div class="export-grid">
        <!-- Export complet -->
        <div class="export-card complete fade-in-mobile">
            <div class="card-icon">üì¶</div>
            <h3 class="card-title">Export Complet</h3>
            <p class="card-description">
                <span class="desktop-only">T√©l√©chargez toutes les donn√©es de votre syst√®me en un seul fichier Excel organis√©.</span>
                <span class="mobile-only">Toutes vos donn√©es en un fichier Excel.</span>
            </p>
            <div class="card-features desktop-only">
                <ul>
                    <li>Tous les licenci√©s et utilisateurs</li>
                    <li>Donn√©es consolid√©es par √©tablissement</li>
                    <li>Historique complet des sessions</li>
                    <li>Format pr√™t pour l'archivage</li>
                </ul>
            </div>
            <div class="card-features mobile-only">
                <ul>
                    <li>Licenci√©s et utilisateurs</li>
                    <li>Par √©tablissement</li>
                    <li>Historique sessions</li>
                </ul>
            </div>
            <a href="{% url 'export_donnees_excel' 'all' %}" class="export-btn export-link">
                <span class="desktop-only">T√©l√©charger l'export complet</span>
                <span class="mobile-only">Export complet</span>
            </a>
        </div>

        <!-- Export utilisateurs -->
        <div class="export-card users fade-in-mobile">
            <div class="card-icon">üë•</div>
            <h3 class="card-title">Export Utilisateurs</h3>
            <p class="card-description">
                <span class="desktop-only">Obtenez la liste d√©taill√©e de tous les utilisateurs avec leurs r√¥les et statistiques.</span>
                <span class="mobile-only">Liste des utilisateurs avec r√¥les et stats.</span>
            </p>
            <div class="card-features desktop-only">
                <ul>
                    <li>Informations personnelles compl√®tes</li>
                    <li>R√¥les et permissions</li>
                    <li>Statistiques d'activit√©</li>
                    <li>Sessions cr√©√©es et valid√©es</li>
                </ul>
            </div>
            <div class="card-features mobile-only">
                <ul>
                    <li>Infos personnelles</li>
                    <li>R√¥les et permissions</li>
                    <li>Stats d'activit√©</li>
                </ul>
            </div>
            <a href="{% url 'export_donnees_excel' 'users' %}" class="export-btn export-link">
                <span class="desktop-only">T√©l√©charger les utilisateurs</span>
                <span class="mobile-only">Export utilisateurs</span>
            </a>
        </div>

        <!-- Export par √©tablissement -->
        <div class="export-card establishment fade-in-mobile">
            <div class="card-icon">üè´</div>
            <h3 class="card-title">Par √âtablissement</h3>
            <p class="card-description">
                <span class="desktop-only">Donn√©es organis√©es par √©tablissement avec licenci√©s et utilisateurs associ√©s.</span>
                <span class="mobile-only">Donn√©es par √©tablissement avec licenci√©s.</span>
            </p>
            <div class="card-features desktop-only">
                <ul>
                    <li>Vue par √©tablissement</li>
                    <li>Licenci√©s et formateurs</li>
                    <li>Statistiques d√©taill√©es</li>
                    <li>Id√©al pour les rapports de direction</li>
                </ul>
            </div>
            <div class="card-features mobile-only">
                <ul>
                    <li>Vue par √©tablissement</li>
                    <li>Licenci√©s et formateurs</li>
                    <li>Stats d√©taill√©es</li>
                </ul>
            </div>
            <a href="{% url 'export_donnees_excel' 'etablissement' %}" class="export-btn export-link">
                <span class="desktop-only">T√©l√©charger par √©tablissement</span>
                <span class="mobile-only">Export √©tablissements</span>
            </a>
        </div>

        <!-- Export licenci√©s -->
        <div class="export-card licencies fade-in-mobile">
            <div class="card-icon">ü•ã</div>
            <h3 class="card-title">Export Licenci√©s</h3>
            <p class="card-description">
                <span class="desktop-only">Rapport sp√©cialis√© sur les licenci√©s avec suivi de pr√©sence et progression.</span>
                <span class="mobile-only">Licenci√©s avec suivi de pr√©sence.</span>
            </p>
            <div class="card-features desktop-only">
                <ul>
                    <li>Liste compl√®te des licenci√©s</li>
                    <li>Grades et niveaux</li>
                    <li>Suivi de pr√©sence d√©taill√©</li>
                    <li>Derni√®re participation</li>
                </ul>
            </div>
            <div class="card-features mobile-only">
                <ul>
                    <li>Liste compl√®te</li>
                    <li>Grades et niveaux</li>
                    <li>Suivi pr√©sence</li>
                </ul>
            </div>
            <a href="{% url 'export_licencies_excel' %}" class="export-btn export-link">
                <span class="desktop-only">T√©l√©charger les licenci√©s</span>
                <span class="mobile-only">Export licenci√©s</span>
            </a>
        </div>
    </div>

    <!-- Section conseils -->
    <div class="tips-section desktop-only">
        <h3 class="tips-title">Conseils d'utilisation</h3>
        <ul class="tips-list">
            <li><strong>Format Excel :</strong> Tous les exports sont g√©n√©r√©s au format .xlsx compatible avec Excel et LibreOffice</li>
            <li><strong>Donn√©es en temps r√©el :</strong> Les rapports refl√®tent l'√©tat actuel de votre base de donn√©es</li>
            <li><strong>Nom des fichiers :</strong> Chaque export inclut automatiquement la date et l'heure de g√©n√©ration</li>
            <li><strong>Ouverture rapide :</strong> Double-cliquez sur le fichier t√©l√©charg√© pour l'ouvrir directement</li>
            <li><strong>Partage s√©curis√© :</strong> Les exports respectent vos permissions d'acc√®s aux √©tablissements</li>
        </ul>
    </div>

    <!-- Version mobile simplifi√©e des conseils -->
    <div class="tips-section mobile-only">
        <h3 class="tips-title">√Ä savoir</h3>
        <ul class="tips-list">
            <li><strong>Format :</strong> Fichiers Excel (.xlsx)</li>
            <li><strong>Donn√©es :</strong> Mises √† jour en temps r√©el</li>
            <li><strong>Fichiers :</strong> Date/heure dans le nom</li>
            <li><strong>S√©curit√© :</strong> Respect de vos permissions</li>
        </ul>
    </div>
</div>

<!-- Overlay de chargement -->
<div class="loading-overlay" id="loadingOverlay">
    <div class="loading-content">
        <div class="spinner"></div>
        <h3>G√©n√©ration en cours...</h3>
        <p>Pr√©paration de votre fichier Excel, veuillez patienter.</p>
    </div>
</div>
{% endblock %}

{% block javascript %}
  <script src="{% static 'presence/mobile/export_page.js' %}"></script>
{% endblock %}