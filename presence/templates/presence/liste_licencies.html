{% extends "presence/base.html" %}
{% load static %}

{% block title %}Liste des licenci√©s{% endblock %}

{% block css %}
    {{ block.super }}
    <link rel="stylesheet" href="{% static 'presence/mobile/parametre.css' %}?v=1">
{% endblock %}

{% block content %}
<div class="mobile-users">
    <!-- En-t√™te -->
    <div class="page-header">
        <h2 class="page-title">üë• Liste des licenci√©s</h2>
    </div>

    <!-- Statistiques c√¥te √† c√¥te -->
    {% if licencies %}
    <div class="stats-row">
        <div class="users-stats">
            <p class="stats-number">{{ licencies|length }}</p>
            <p class="stats-label">licenci√©{{ licencies|length|pluralize }}</p>
        </div>
        <div class="users-stats">
            <a href="{% url 'ajouter_licencie' %}" class="stats-add-btn">
                <span class="action-btn-icon">‚ûï</span>
                Ajouter
            </a>
        </div>
    </div>
    {% else %}
    <div class="stats-row">
        <div class="users-stats">
            <p class="stats-number">0</p>
            <p class="stats-label">aucun licenci√©</p>
        </div>
        <div class="users-stats">
            <a href="{% url 'ajouter_licencie' %}" class="stats-add-btn">
                <span class="action-btn-icon">‚ûï</span>
                Ajouter
            </a>
        </div>
    </div>
    {% endif %}

    <!-- Filtrage √©tablissement (pour superusers) -->
    {% if request.user.is_superuser %}
    <form method="get" class="filter-form">
        <label for="etablissement">Filtrer par √©tablissement :</label>
        <select name="etablissement" id="etablissement" onchange="this.form.submit()">
            <option value="">Tous</option>
            {% for etab in etablissements %}
                <option value="{{ etab.id }}" {% if request.GET.etablissement == etab.id|stringformat:"s" %}selected{% endif %}>
                    {{ etab.name }}
                </option>
            {% endfor %}
        </select>
    </form>
    {% endif %}

    <!-- Affichage conditionnel -->
    <div class="etablissement-info">
        {% if request.user.is_superuser %}
            <p><strong>Affichage de tous les licenci√©s.</strong></p>
        {% elif request.user.profile.etablissement %}
            <p><strong>√âtablissement :</strong> {{ request.user.profile.etablissement.name }}</p>
        {% else %}
            <p><strong>Attention :</strong> Aucun √©tablissement associ√© √† votre compte.</p>
        {% endif %}
    </div>

    <!-- Liste des licenci√©s -->
    {% if licencies %}
        <div class="users-grid">
            {% for licencie in licencies %}
                <div class="user-card">
                    <!-- En-t√™te -->
                    <div class="user-header">
                        <h3 class="user-name">{{ licencie.prenom }} {{ licencie.nom }}</h3>
                        <span class="grade-badge">{{ licencie.grade|default:"N/A" }}</span>
                    </div>

                    <!-- Infos -->
                    <div class="user-content">
                        <div class="user-info">

                            <!-- Participation -->
                            <div class="info-item">
                                <span class="info-icon">‚úÖ</span>
                                <div class="info-content">
                                    <div class="info-label">Pr√©sences</div>
                                    <div class="info-value">{{ licencie.nb_presences }}</div>
                                </div>
                            </div>

                            <!-- Derni√®re pr√©sence -->
                            <div class="info-item">
                                <span class="info-icon">üìÖ</span>
                                <div class="info-content">
                                    <div class="info-label">Derni√®re pr√©sence</div>
                                    <div class="info-value">
                                        {% if licencie.last_session_date %}
                                            {{ licencie.last_session_date|date:"d/m/Y" }}
                                        {% else %}
                                            ‚Äî Aucune
                                        {% endif %}
                                    </div>
                                </div>
                            </div>

                            <!-- √âtablissement -->
                            {% if request.user.is_superuser %}
                            <div class="info-item">
                                <span class="info-icon">üè¢</span>
                                <div class="info-content">
                                    <div class="info-label">√âtablissement</div>
                                    <div class="info-value">
                                        {{ licencie.etablissement.name|default:"Non renseign√©" }}
                                    </div>
                                </div>
                            </div>
                            {% endif %}

                        </div>
                    </div>

                    <!-- Actions -->
                    <div class="user-actions">
                        <a href="{% url 'detail_licencie' licencie.id %}" class="user-action-btn btn-view">
                            <span>üëÅÔ∏è</span>
                            Voir
                        </a>
                        <!-- <a href="{% url 'modifier_licencie' licencie.id %}" class="user-action-btn btn-edit">
                            ‚úèÔ∏è Modifier
                        </a>
                        <form action="{% url 'supprimer_licencie' licencie.id %}" method="get" style="display:inline;">
                            <button type="submit" class="user-action-btn btn-delete">‚ùå Supprimer</button>
                        </form> -->
                    </div>
                </div>
            {% endfor %}
        </div>
    {% else %}
        <div class="no-users-container">
            <div class="no-users-icon">üë§</div>
            <h3 class="no-users-title">Aucun licenci√© trouv√©</h3>
            <p class="no-users-text">Aucun licenci√© n'a encore √©t√© enregistr√©.</p>
        </div>
    {% endif %}
</div>
{% endblock %}